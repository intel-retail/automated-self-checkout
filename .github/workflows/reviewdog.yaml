name: reviewdog
on: 
  pull_request_target:
    types: [opened, synchronize, reopened]
jobs:
  reviewdog:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
        - name: Checkout code
          uses: actions/checkout@v3
          with:
            ref: ${{ github.event.pull_request.head.sha }}
        - name: Install go
          uses: actions/setup-go@v4
          with:
            go-version: 1.20
        - name: Install golangci-lint
          run: |
            mkdir -p ./golangci
            sudo curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b ./golangci v1.51.2
        - name: Install shellcheck
          run: |
            sudo apt install shellcheck
        - name: Install bandit
          run: |
            pip install bandit && bandit --version
        - name: Install pep8
          run: |
              sudo apt install pep8
        - name: Install hadolint
          env:
            HADOLINT_VERSION: v1.16.3
          run: |
            wget -q https://github.com/hadolint/hadolint/releases/download/$HADOLINT_VERSION/hadolint-Linux-x86_64 -O /tmp/hadolint \
            && chmod +x /tmp/hadolint
        - name: Install reviewdog
          run: |
            curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh | sh -s
        - name: Run Reviewdog
          env:
            REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            REVIEWDOG_FAIL_ON_ERROR: 'true'
          run: |
            echo $REVIEWDOG_GITHUB_API_TOKEN
            echo $REVIEWDOGTOKEN
            export PATH=$PATH:${GITHUB_WORKSPACE}/golangci/golangci-lint
            echo ${GITHUB_WORKSPACE}/golangci
            ls -a ./
            ./golangci/golangci-lint --version
            ./bin/reviewdog -conf .reviewdog.yml -reporter=github-pr-check
            

        
        
